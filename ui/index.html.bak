<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>assistant v1.7.9</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="layout">
      <aside class="sidebar">
        <div class="brand">rag</div>
        <div class="section">
          <div class="section-title">Chat History</div>
          <select id="chatList"></select>
          <div class="row">
            <button id="newChatBtn" class="primary">new chat</button>
            <button id="clearChatBtn">clear</button>
            <button id="exportBtn">export chat</button>
          </div>
        </div>

        <div class="section">
          <div class="section-title">settings</div>
          <div class="settings-left">
            <label class="setting">
              <span>temperature</span>
              <input type="range" id="temp" min="0.1" max="1.0" value="0.4" step="0.05" />
              <small>current: <span id="tempVal">0.4</span></small>
            </label>
            <label class="setting" title="Let the model plan before answering (more structured)"><span>Plan</span> <input type="checkbox" id="plan" checked /></label>
            <label class="setting" title="Add a quick self-review of the draft"><span>Self-check</span> <input type="checkbox" id="selfCheck" /></label>
            <label class="setting" title="Show internal thinking plan (if available)"><span>Show thinking</span> <input type="checkbox" id="showThinking" /></label>
            <label class="setting" title="How many planning iterations"><span>Plan depth</span> <input type="number" id="planDepth" min="1" max="4" value="2" /></label>
            <label class="setting" title="Stream tokens live"><span>Stream</span> <input type="checkbox" id="stream" checked /></label>

            <details class="adv-settings"><summary>Advanced generation</summary>
              <div class="grid">
                <label title="Candidate pool per step; higher = more diverse">Top K <input type="number" id="setTopK" min="1" max="200" placeholder="(model default: 40)" /></label>
                <label title="Nucleus sampling; lower = safer, higher = chattier">Top P <input type="number" id="setTopP" min="0" max="1" step="0.01" placeholder="(default: 0.9)" /></label>
                <label title="Discourage repetition; 1.0 = off">Repeat penalty <input type="number" id="setRep" min="0" max="2" step="0.01" placeholder="(default: 1.1)" /></label>
                <label title="Penalize frequent tokens; 0.0–0.5 typical">Freq penalty <input type="number" id="setFreq" min="-2" max="2" step="0.01" placeholder="(default: 0.0)" /></label>
                <label title="How many documents to retrieve before answering">Retrieval Top K <input type="number" id="setRetrK" min="1" max="20" value="5" /></label>
              </div>
              <div class="row"><button id="resetSettingsBtn">Reset to defaults</button></div>
              <small>Changes apply to the next message. Content length is capped at <span id="capVal">25000</span> characters.</small>
            </details>
            <details class="adv-settings"><summary>assistant policy</summary>
              <ul>
                <li>cites only internal files (Docs/... or repo_...)</li>
                <li>no meta/browsing disclaimers in replies</li>
                <li>code-first for make/build/implement prompts</li>
                <li>lua fenced blocks (```lua) with highlight</li>
              </ul>
              <small>api dump: <span id="apiStatus">checking…</span></small>
            </details>
          </div>
        </div>
      </aside>

      <main class="main">
        <div class="topbar">
          <div class="title">speak to the assistant here</div>
          <div class="subtitle" id="modelTag"></div>
        </div>

        <div class="main-grid">
          <div>
            <div id="chat" class="chat"></div>
            <div class="composer">
              <textarea id="msg" rows="3" placeholder="type, change settings, and send."></textarea>
              <div class="controls">
                <button id="send" class="primary">Send</button>
              </div>
            </div>
          </div>

          <aside class="docs" id="docsPane">
            <div class="preview-title">Docs Viewer</div>
            <input id="docSearch" class="doc-search" placeholder="filter files..." />
            <div id="docsList" class="docs-list"></div>
<div class="row">
  <button id="pinBtn">Pin to next</button>
  <button id="clearPinBtn">Clear pin</button>
  <span id="pinStatus"></span>
</div>
            <div id="docView" class="docs-view"></div>
          </aside>
        </div>

        <details id="thinkingPanel" class="thinking"><summary>Thinking (steps)</summary><pre><code id="thinking"></code></pre></details>
      </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.2/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.1.6/purify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/lua.min.js"></script>
    <script>hljs.configure({ignoreUnescapedHTML: true});</script>
    <script src="app.js"></script>
  </body>
  </html>
